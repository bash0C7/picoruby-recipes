# ATOM Matrix PicoRuby デモンストレーション集

本ディレクトリにはM5ATOM Matrix用のPicoRubyサンプルコードが収録されています。

# asr.rb

Unit ASR音声認識モジュール（CI-03T）による音声コマンド検出プログラム（手続き型実装）。

**機能:**
- "hello"コマンド認識時：内蔵LEDをオレンジ色表示
- "ok"コマンド認識時：内蔵LEDをシアン色表示
- 待機時：内蔵LEDを暗い青色表示
- Grove UART通信による高速データ処理（115200bps）
- メモリ効率重視の5バイト一括読み取り

**動作要件:**
- 接続: Grove UART（GPIO26:TX, GPIO32:RX, 115200bps）
- LED制御: GPIO27（内蔵5x5マトリックス, 25個）
- コマンドコード: 0x32("hello"), 0x30("ok")

# asr_c.rb

Unit ASR音声認識モジュール（CI-03T）のオブジェクト指向ラッパークラス実装。

**機能:**
- UnitASRクラスによるコマンドハンドラーパターン
- 登録可能なコマンド処理ブロック
- 未登録コマンド用デフォルトハンドラー
- UART受信バッファの自動管理
- ウェイクアップ状態監視

**実装特徴:**
- コマンドごとの処理ブロック登録システム
- UART受信データの効率的なバッファリング
- パケット解析とコマンド抽出
- デバッグ機能（バッファサイズ、覚醒状態表示）

**動作要件:**
- 接続: Grove UART（GPIO26:TX, GPIO32:RX, 115200bps）
- 基本同asr.rbと同じハードウェア構成

# led_ext.rb

Grove拡張ポート（GPIO32）経由のWS2812 LED制御プログラム。

**機能:**
- 15個のWS2812 LEDを加速度センサー連動制御
- MPU6886センサーによるX軸傾斜検出（左:赤, 中央:緑, 右:青）
- 加速度の大きさによる輝度自動調整（通常:51, 高加速度:128）
- メモリ最適化の整数演算による三角波アニメーション

**接続:**
- GPIO32（Grove経由）
- 15個WS2812 LEDストリップ
- MPU6886（内蔵I2C, SDA:25, SCL:21）

# led_int.rb

ATOM Matrix内蔵5x5 LEDマトリックス制御プログラム。

**機能:**
- 内蔵25個のWS2812 LEDをオレンジ色で点灯
- 安全な輝度レベル30設定（発熱防止）
- シンプルな連続点灯モード
- センサー未使用のフラット構造

**接続:**
- GPIO27（内蔵配線）
- 内蔵25個5x5 LEDマトリックス

# led_j3_25.rb

拡張ボードJ3ポート経由の25連LEDストリップ制御（オレンジ色固定表示）。

**機能:**
- 25個のWS2812 LEDをオレンジ色固定表示
- 安全な輝度設定による発熱防止
- シンプルな連続点灯モード
- センサー非使用のフラット構造

**接続:**
- GPIO25（J3 PortB、ただしコード内では別GPIO使用）
- 25個WS2812 LEDストリップ

# led_j5_60.rb

拡張ボードJ5ポート経由の60連LEDストリップ制御。

**機能:**
- 60個のWS2812 LEDを加速度センサー連動制御
- MPU6886センサーによるX軸傾斜検出（左:赤, 中央:緑, 右:青）
- 加速度の大きさによる輝度自動調整（通常:51, 高加速度:128）
- メモリ最適化の整数演算による三角波アニメーション

**接続:**
- GPIO22（J5 PortD）
- 60個WS2812 LEDストリップ
- MPU6886（内蔵I2C, SDA:25, SCL:21）

# syn.rb

MIDI Unit（SAM2695）を使用したシンセサイザー演奏プログラム。

**機能:**
- 3チャンネル同時演奏（Piano, Trumpet, Violin）
- 和音演奏デモンストレーション（C-E-G, D-F-A, E-G-B, F-A-C, G-B-D）
- バイナリMIDIメッセージ制御（.chrメソッド使用）
- 標準MIDI通信（31250bps）

**接続:**
- Grove UART（GPIO26:TX, GPIO32:RX）
- MIDIボーレート: 31250bps
- MIDI Unit SAM2695チップ使用

# syn_atom.rb

PCからのMIDI信号受信とLED視覚化プログラム。

**機能:**
- USB経由でのMIDI受信・転送（PC ↔ ATOM Matrix ↔ MIDI Unit）
- 内蔵5x5 LEDマトリックス（25個）での視覚化
- ノート番号（% 25）に基づくLED位置制御
- オクターブ（note/12 % 6）による6色分け（赤, 黄, 緑, シアン, 青, マゼンタ）
- ベロシティによる輝度制御（最大255）
- 隣接LEDへの弱い光の拡散効果

**通信:**
- PC: USB UART（115200bps）
- MIDI Unit: Grove UART（GPIO26:TX, GPIO32:RX, 31250bps）
- LED制御: GPIO27（内蔵5x5マトリックス）

# syn_pc.rb

PC側MIDIブリッジプログラム（参考実装、廃止予定）。

**機能:**
- UniMIDI使用のMIDI入力デバイス選択・接続
- PC MIDIデバイスからの入力取得（Note On/Off, CC, PC, PitchBend対応）
- ATOM Matrixへのリアルタイムシリアル転送（115200bps）
- MIDIメッセージ有効性チェック・エラーハンドリング

**依存関係:**
- unimidiライブラリ（PC側Ruby環境）
- シリアル通信ポート設定（/dev/cu.usbserial-*）
- ポーリングループによるノンブロッキング処理

**注記:** 現在はPC側アプリケーションは `../../../pc/` ディレクトリに移動済み

# tof.rb

VL53L0X ToF距離センサーによる距離測定プログラム。

**機能:**
- 30mm～2000mmの距離測定
- 距離カテゴリ表示（Very Close～Very Far）
- 200ms間隔での連続測定

**接続:**
- PortB I2C（GPIO25:SDA, GPIO21:SCL）
- I2Cアドレス: 0x29
- MPU6886と同一バス共用

# imu.rb

MPU6886内蔵IMUセンサーデータ表示プログラム。

**機能:**
- 3軸加速度センサー値表示（±4G範囲）
- 3軸ジャイロスコープ値表示（±2000deg/s範囲）
- チップ温度表示
- 500ms間隔でのシンプルなデータ出力

**接続:**
- 内蔵MPU6886（GPIO25:SDA, GPIO21:SCL）
- I2Cアドレス: 0x68

---

---

# PC側アプリケーション（../../../pc/ ディレクトリ）

PC側のCRuby実行用プログラム群。開発ワークフロー支援ツール。

## notify_caller.rb

Claude Code Hook通知プログラム。

**機能:**
- Claude Codeのフック実行時にユーザーへの視覚的通知
- ATOM Matrixシリアルデバイス（/dev/cu.usbserial*）への通信試行
- デバイスが利用できない場合のMac単体通知
- アラートダイアログ表示とシステム音再生

**使用方法:**
- Claude Code設定でフックプログラムとして登録
- 引数指定によりATOM Matrixに送信するコマンド文字列を変更可能
- デフォルト送信文字列："b"

**動作環境:**
- macOS（osascript使用）
- Ruby標準ライブラリ（system, Dir.glob使用）
- ATOM Matrix接続時の自動デバイス検出

---

**共通注意事項:**
- メモリ最適化のため例外処理とクラス実装は最小限に抑制
- GPIO設定はハードウェア仕様に準拠
- I2Cバス共用時のアドレス競合は回避済み
- PC側アプリケーションはCRuby環境で実行